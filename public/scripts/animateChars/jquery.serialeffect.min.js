/*!
 * jQuery serialeffect
 * https://github.com/kevinmeunier/jquery-serialeffect
 *
 * Copyright 2022 Meunier Kévin
 * https://www.meunierkevin.com
 *
 * Released under the MIT license
 */
!function(e){"use strict";const t=window.matchMedia("(pointer: coarse)").matches;e.serialeffect=function(s){const n=e.extend({},e.serialeffect.defaults,s),l=this;let a,i=document.documentElement.clientHeight,c=!1,o=window.scrollY,r=!1,f=[],u=[],d="advanced",m=null,h=null,p=null,b=!1;e.extend(this,{init:function(){this.defineCollections(),t?l.setReady():(l.setAlwaysInViewport(),this.setCollectionsMax(),l.setPositions(),window.addEventListener("resize",function(){l.debounceEvent(l.eventResize)}),window.addEventListener("scroll",function(){o=window.scrollY,l.debounceEvent(l.eventScroll)}),l.setReady())},defineCollections:function(){e(n.sectionsSelector).each(function(t){f.push({section:this,elements:[]});const s=f[t];e(this).find(n.elementsSelector).each(function(){if(!this.classList.contains(n.ignoreClass)&&!e(this).parents("."+n.ignoreClass).length)if(this.classList.contains("is-word"))s.elements.push({word:this,letters:Array.from(this.getElementsByClassName("is-letter"))});else{if(this.classList.contains("is-letter"))return;if(this.classList.contains("is-visual"))s.elements.push({visual:this});else if("IMG"==this.tagName||"g"==this.tagName)this.classList.add(n.elementsClass),this.classList.add("is-visual"),s.elements.push({visual:this});else if(null!=this.firstChild&&this.firstChild.textContent.trim().length>0&&3==this.firstChild.nodeType){const e=l.getWords(this);for(let t of e)t.innerHTML=t.innerHTML.replace(/\S/g,'<span class="'+n.elementsClass+' is-letter" aria-hidden="true">$&</span>'),s.elements.push({word:t,letters:Array.from(t.getElementsByClassName(n.elementsClass))});this.ariaLabel=this.textContent}}})})},getWords:function(e){let t=e.innerHTML.split(" "),s=[];for(const e in t)-1!=t[e].indexOf("-")||-1!=t[e].indexOf(",")||-1!=t[e].indexOf(".")?s.push('<span class="js-serialeffect-compounded" aria-hidden="true">'+t[e].replace(/[A-zÀ-ú]+|[-,.]/g,'<span class="'+n.elementsClass+' is-word" aria-hidden="true">$&</span>')+"</span>"):s.push('<span class="'+n.elementsClass+' is-word" aria-label="'+t[e]+'">'+t[e]+"</span>");return e.innerHTML=s.join(" "),Array.from(e.getElementsByClassName(n.elementsClass))},setAlwaysInViewport:function(){l.eachCollectionElement({callback:function(t){t["serialeffect-alwaysinviewport"]=function(t){const s=e(t),n=s.add(s.parents());let l=!1;return n.each(function(){if("fixed"===e(this).css("position"))return l=!0,!1}),l}(t)},callbackSections:!0,callbackWords:!0,callbackVisuals:!0,callbackLetters:!0,onlyViewport:!1})},setCollectionsMax:function(){l.eachCollectionElement({callback:function(e){const t=e.dataset.serialeffectMax||n.maxGap;e["serialeffect-max"]=(Math.random()*(t-1)+1).toFixed()},callbackSections:!1,callbackWords:"standard"==d,callbackVisuals:!0,callbackLetters:"advanced"==d,onlyViewport:!0})},eachCollectionElement:function(e){for(let t of f)if(1!=b||1!=e.onlyViewport||0!=l.isInViewport(t.section)){1==e.callbackSections&&e.callback(t.section);for(let s of t.elements){const t=s.word||s.visual;if((1!=b||1!=e.onlyViewport||0!=l.isInViewport(t))&&(1==e.callbackWords&&s.word&&e.callback(s.word),1==e.callbackVisuals&&s.visual&&e.callback(s.visual),1==e.callbackLetters&&s.letters))for(let t of s.letters)e.callback(t)}}},setPositions:function(){i=document.documentElement.clientHeight,l.eachCollectionElement({callback:function(t){t["serialeffect-offetTop"]=e(t).offset().top,t["serialeffect-offsetBottom"]=t["serialeffect-offetTop"]+t.clientHeight},callbackSections:!0,callbackWords:!0,callbackVisuals:!0,callbackLetters:!1,onlyViewport:!1})},debounceEvent:function(e){r||requestAnimationFrame(function(){e(),r=!1}),r=!0},eventResize:function(){c=!0},eventScroll:function(){if("advanced"==d&&l.checkPerformance(),1==c&&(l.setPositions(),c=!1),null==h)return void(h=o);if(a=o-h,h=o,a==m)return;m=a,null!=p&&clearTimeout(p),p=setTimeout(function(){h=null,m=null,l.animateAfter(),n.callback&&"function"==typeof n.callback&&n.callback(e)},50),a>200&&(a=200),a<-200&&(a=-200);const e=(a/200*100).toFixed()/100;n.callback&&"function"==typeof n.callback&&n.callback(e),l.animate(e)},animate:function(e){l.eachCollectionElement({callback:function(t){t.style.transform="translateY("+e*t["serialeffect-max"]+"px)",u.push(t)},callbackSections:!1,callbackWords:"standard"==d,callbackVisuals:!0,callbackLetters:"advanced"==d,onlyViewport:!0})},animateAfter:function(){l.setCollectionsMax();for(let e of u)e.style.transform="",u=[]},checkPerformance:function(){(()=>new Promise(e=>requestAnimationFrame(t=>requestAnimationFrame(s=>e(1e3/(s-t))))))().then(function(e){e<20&&(l.eachCollectionElement({callback:function(e){e.style.transform=""},callbackSections:!1,callbackWords:!1,callbackVisuals:!1,callbackLetters:!0,onlyViewport:!1}),d="standard")})},isInViewport:function(e){if(1==e["serialeffect-alwaysinviewport"])return!0;const t=e["serialeffect-offetTop"];return e["serialeffect-offsetBottom"]>o&&t<o+i},setReady:function(){document.body.setAttribute("data-serialeffect-state","ready"),b=!0}}),this.init()},e.serialeffect.defaults={sectionsSelector:"section",elementsSelector:"div, p, li, h1, img, span, a, g",elementsClass:"js-serialeffect",ignoreClass:"js-serialeffect-ignore",maxGap:200,callback:!1}}(jQuery);
